<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>Treemap - Neat Zoom Effect</title>
    <script type="text/javascript" src="http://www.billdwhite.com/wordpress/wp-content/js/browserdetect/browserdetect.js"></script>
    <script type="text/javascript" src="http://www.billdwhite.com/wordpress/wp-content/js/d3/d3.js"></script>
    <style type="text/css">
        body {
            
            margin: 0;
            font-size: 12px;
            font-family: "Helvetica Neue", Helvetica;
        }

        .footer {
            z-index: 1;
            display: block;
            font-size: 26px;
            font-weight: 200;
            text-shadow: 0 1px 0 #fff;
        }

        svg {
            overflow: hidden;
        }

        rect {
            pointer-events: all;
            cursor: pointer;
            stroke: #EEEEEE;
        }

        .chart {
            display: block;
            margin: auto;
        }

        .parent .label {
            color: #FFFFFF;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
            -webkit-text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
            -moz-text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
        }

        .labelbody {
            background: transparent;
        }

        .label {
            margin: 2px;
            white-space: pre;
            overflow: hidden;
            text-overflow: ellipsis;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
            -webkit-text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
            -moz-text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
        }

        .child .label {
            white-space: pre-wrap;
            text-align: center;
            text-overflow: ellipsis;
        }

        .cell {
            font-size: 11px;
            cursor: pointer
        }
    </style>
</head>
<body>
<div id="body"></div>
<div class="footer">
    <select>
        <option value="size">Size</option>
        <option value="count">Count</option>
    </select>
</div>


<script type="text/javascript">
   var width = 1960,
    height = 600,
    color = d3.scale.category10();

var treemap = d3.layout.treemap()
    .padding(4)
    .size([width, height])
    .mode("squarify")
    .ratio(5/4)
    .sort(d3.descending)
    .value(function(d) { return d.nota; });

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(-.5,-.5)");

d3.json("./data/pelis.json", function(error, json) {
  var cell = svg.data([json]).selectAll("g")
      .data(treemap.nodes)
    .enter().append("g")
      .attr("class", "cell")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });


  cell.append("rect")
      .attr("width", function(d) { return d.dx; })
      .attr("height", function(d) { return d.dy; })
      
      .style("fill", function(d) { return color(d.nota); })
      .on("mouseover", function(d){d3.select(this).style("fill", "#444");d3.select(this).style("stroke", "#000");})
      .on("mouseout", function(d){d3.select(this).style("fill", color(d.nota));d3.select(this).style("stroke", "#fff");})
      .on("mousedown", animate);

  cell.append("text")
      .attr("x", function(d) { return d.dx / 2; })
      .attr("y", function(d) { return d.dy / 2; })
      .attr("dy", ".35em")
      .attr("fill","#fff")
      .attr("text-anchor", "middle")
      .text(function(d) { return d.children ? null : d.name; });
      
      
    function animate() {        
        width=2*d3.select(this).attr("width");
        height=2*d3.select(this).attr("height");
        d3.select(this).transition()
        .duration(1000)
        .attr("width", width)
        .attr("height", height)
        .transition()
        .delay(1000);
    }    
});
</script>
</body>
</html>